apiVersion: jenkins.io/v1alpha2
kind: Jenkins
metadata:
  name: jenkins
  namespace: jenkins-operator
spec:
  configurationAsCode:
    configurations:
      - name: jenkins-casc
  jenkinsAPISettings:
    authorizationStrategy: serviceAccount
  master:
    disableCSRFProtection: false
    containers:
      - name: jenkins-master
        image: jenkins/jenkins:2.516.1-lts
        imagePullPolicy: Always
        livenessProbe:
          failureThreshold: 12
          httpGet:
            path: /login
            port: http
            scheme: HTTP
          initialDelaySeconds: 120
          periodSeconds: 30
          successThreshold: 1
          timeoutSeconds: 10
        readinessProbe:
          failureThreshold: 10
          httpGet:
            path: /login
            port: http
            scheme: HTTP
          initialDelaySeconds: 80
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        resources:
          limits:
            cpu: "2"
            memory: "4Gi"
          requests:
            cpu: "500m"
            memory: "1Gi"
        env:
          - name: JAVA_OPTS
            value: "-Djenkins.install.runSetupWizard=false -Djava.awt.headless=true -Xmx2g"
    persistence:
      storageClassName: "longhorn"
      accessMode: ReadWriteOnce
      size: 10Gi
    basePlugins:
      - name: configuration-as-code
        version: "1985.vdda_32d0c4ea_b_"
      - name: git
        version: "5.7.0"
      - name: job-dsl
        version: "1.89"
      - name: kubernetes
        version: "4295.v7fa_01b_309c95"
      - name: kubernetes-credentials-provider
        version: "1.262.v2670ef7ea_0c5"
      - name: workflow-aggregator
        version: "600.vb_57cdd26fdd7"
  service:
    type: ClusterIP
    port: 8080
  serviceAccount:
    annotations:
      jenkins.io/operator-managed: "true"
